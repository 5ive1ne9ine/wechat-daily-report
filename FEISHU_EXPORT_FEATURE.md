# 飞书多维表格导出功能

## 功能概述

本功能支持将微信聊天记录导出到飞书多维表格中，支持AI智能分类和消息摘要，方便用户对聊天记录进行整理和分析。

## 主要特性

### 1. 飞书应用配置
- 支持配置飞书应用的 App ID 和 App Secret
- 自动验证连接状态
- 安全存储应用凭证

### 2. 智能数据处理
- **AI智能分类**：自动对消息进行分类（工作讨论、技术分享、日常闲聊等）
- **消息摘要**：对过长消息自动生成简洁摘要（不超过30字）
- **重要程度评估**：AI评估消息重要性（高/中/低）
- **关键词提取**：自动提取消息关键词

### 3. 灵活的导出配置
- 自定义时间范围导出
- 支持群聊和个人聊天
- 可选择是否启用AI分析
- 自定义表格名称

### 4. 表格字段说明

导出的多维表格包含以下字段：

| 字段名 | 类型 | 说明 |
|--------|------|------|
| 消息内容 | 文本 | 完整的消息内容 |
| 时间 | 文本 | 消息发送时间 |
| 发送人 | 文本 | 消息发送者 |
| 消息摘要 | 文本 | AI生成的消息摘要（长消息） |
| 消息类型 | 单选 | AI分类的消息类型 |
| 群名 | 文本 | 群聊或聊天对象名称 |
| 日期 | 日期 | 消息日期 |
| 重要程度 | 单选 | high/medium/low |
| AI分类 | 文本 | AI智能分类结果 |
| 关键词 | 文本 | 提取的关键词 |

## 使用步骤

### 第一步：配置飞书应用

1. 访问 [飞书开放平台](https://open.feishu.cn/app) 创建企业自建应用
2. 在应用管理页面获取 `App ID` 和 `App Secret`
3. 在应用权限配置中开通「多维表格」相关权限
4. 在应用设置中填写获取的凭证信息

### 第二步：配置AI服务

确保已正确配置AI服务（OpenAI/OpenRouter等），用于智能分析功能。

### 第三步：配置Chatlog连接

确保Chatlog服务正常运行并已连接。

### 第四步：导出数据

1. 点击顶部导航栏的「飞书导出」按钮
2. 选择时间范围
3. 选择要导出的聊天对象
4. 配置导出选项（表格名称、是否启用AI分析）
5. 点击「开始导出」

## 技术实现

### 核心服务

- **FeishuService**: 负责飞书API集成
  - 令牌管理和自动刷新
  - 多维表格创建和管理
  - 批量数据写入

- **AI智能分析**: 
  - 消息内容分析和分类
  - 重要性评估
  - 关键词提取
  - 长消息摘要生成

### API调用优化

- 实现了令牌自动刷新机制
- 批量数据上传（每批100条记录）
- 错误重试和异常处理
- 频率限制控制

### 用户体验优化

- 实时进度显示
- 详细的状态反馈
- 错误信息提示
- 成功后自动跳转

## 注意事项

1. **权限配置**：确保飞书应用具有多维表格的创建和编辑权限
2. **API限制**：飞书API有频率限制，大量数据导出可能需要较长时间
3. **数据安全**：App Secret 安全存储在本地，请妥善保管
4. **AI分析**：启用AI分析会显著增加导出时间，但提供更丰富的数据洞察
5. **网络连接**：需要稳定的网络连接访问飞书API

## 故障排除

### 常见问题

1. **连接测试失败**
   - 检查App ID和App Secret是否正确
   - 确认网络连接正常
   - 验证飞书应用权限配置

2. **导出失败**
   - 检查选定时间段是否有聊天记录
   - 确认AI服务配置正常（如启用AI分析）
   - 查看日志获取详细错误信息

3. **表格创建失败**
   - 确认飞书应用具有多维表格权限
   - 检查应用是否在正确的企业空间下

## 更新历史

- **v1.0.0**: 基础飞书导出功能
  - 支持聊天记录导出
  - AI智能分析
  - 多维表格自动创建
  - 进度监控和错误处理 